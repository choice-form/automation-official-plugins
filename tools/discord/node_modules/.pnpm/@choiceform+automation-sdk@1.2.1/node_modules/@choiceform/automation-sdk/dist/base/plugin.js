/**
 * èŠ‚ç‚¹æ’ä»¶åŸºç±» - ä¸“ä¸šçš„å·¥ä½œæµå¼€å‘æ¡†æ¶
 *
 * ç‰¹æ€§ï¼š
 * - ğŸš€ é›¶ä¾èµ–è®¾è®¡ï¼Œå®Œå…¨å…¼å®¹èŠ‚ç‚¹å¼å·¥ä½œæµä½“ç³»
 * - ğŸ”§ å®Œå–„çš„å¼€å‘å·¥å…·é“¾
 * - ğŸ¯ ç±»å‹å®‰å…¨çš„ TypeScript æ”¯æŒ
 * - ğŸ“¦ æ”¯æŒçƒ­é‡è½½å’Œå®æ—¶è°ƒè¯•
 * - âœ… ä¸¥æ ¼çš„ nodes-config å…¼å®¹æ€§
 * - ğŸ”„ å·¥ä½œæµçº§åˆ«çš„é”™è¯¯å¤„ç†
 */
export class Plugin {
    definition;
    context;
    constructor(definition) {
        this.definition = definition;
    }
    /**
     * è·å–æ’ä»¶å®šä¹‰ä¿¡æ¯
     */
    getDefinition() {
        return this.definition;
    }
    /**
     * è®¾ç½®æ‰§è¡Œä¸Šä¸‹æ–‡
     */
    setContext(context) {
        this.context = context;
    }
    /**
     * éªŒè¯è¾“å…¥å‚æ•°
     */
    validateInputs(inputs) {
        const errors = [];
        const warnings = [];
        // éªŒè¯å¿…éœ€å‚æ•°
        if (this.definition.parameters) {
            for (const param of this.definition.parameters) {
                if (param.required && !(param.name in inputs)) {
                    errors.push({
                        field: param.name,
                        message: `å‚æ•° ${param.name} æ˜¯å¿…éœ€çš„`,
                        code: 'REQUIRED_PARAMETER_MISSING'
                    });
                }
                // ç±»å‹éªŒè¯
                const value = inputs[param.name];
                if (value !== undefined && !this.validateParameterType(value, param.type)) {
                    errors.push({
                        field: param.name,
                        message: `å‚æ•° ${param.name} ç±»å‹ä¸åŒ¹é…ï¼ŒæœŸæœ› ${param.type}`,
                        code: 'TYPE_MISMATCH'
                    });
                }
                // èŒƒå›´éªŒè¯
                if (typeof value === 'number' && param.min !== undefined && value < param.min) {
                    errors.push({
                        field: param.name,
                        message: `å‚æ•° ${param.name} ä¸èƒ½å°äº ${param.min}`,
                        code: 'VALUE_OUT_OF_RANGE'
                    });
                }
                if (typeof value === 'number' && param.max !== undefined && value > param.max) {
                    errors.push({
                        field: param.name,
                        message: `å‚æ•° ${param.name} ä¸èƒ½å¤§äº ${param.max}`,
                        code: 'VALUE_OUT_OF_RANGE'
                    });
                }
            }
        }
        return {
            isValid: errors.length === 0,
            errors,
            warnings
        };
    }
    /**
     * å¥åº·æ£€æŸ¥
     */
    async healthCheck() {
        const checks = [];
        // åŸºç¡€é…ç½®æ£€æŸ¥
        checks.push({
            name: 'configuration',
            status: this.definition ? 'pass' : 'fail',
            message: this.definition ? 'é…ç½®æœ‰æ•ˆ' : 'é…ç½®ç¼ºå¤±'
        });
        // ä¸Šä¸‹æ–‡æ£€æŸ¥
        checks.push({
            name: 'context',
            status: this.context ? 'pass' : 'warn',
            message: this.context ? 'ä¸Šä¸‹æ–‡å·²è®¾ç½®' : 'ä¸Šä¸‹æ–‡æœªè®¾ç½®'
        });
        return {
            status: checks.every(c => c.status === 'pass') ? 'healthy' :
                checks.some(c => c.status === 'fail') ? 'unhealthy' : 'degraded',
            timestamp: Date.now(),
            checks
        };
    }
    /**
     * è®°å½•æ—¥å¿—
     */
    log(level, message) {
        if (this.context?.log) {
            this.context.log(level, message);
        }
        else {
            // å›é€€åˆ°æ§åˆ¶å°è¾“å‡º
            console[level](`[${this.definition.identity.name}] ${message}`);
        }
    }
    /**
     * è·å–å‡­æ®
     */
    async getCredential(name) {
        return this.context?.getCredential(name);
    }
    /**
     * å­˜å‚¨æ•°æ®
     */
    async storeData(key, value) {
        await this.context?.storeData(key, value);
    }
    /**
     * æ£€ç´¢æ•°æ®
     */
    async retrieveData(key) {
        return await this.context?.retrieveData(key) || null;
    }
    /**
     * åˆ›å»ºæˆåŠŸç»“æœ
     */
    createSuccessResult(data, metadata) {
        return {
            success: true,
            data,
            metadata
        };
    }
    /**
     * åˆ›å»ºé”™è¯¯ç»“æœ
     */
    createErrorResult(message, code, details) {
        return {
            success: false,
            error: {
                message,
                code,
                details
            }
        };
    }
    /**
     * éªŒè¯å‚æ•°ç±»å‹
     */
    validateParameterType(value, expectedType) {
        switch (expectedType) {
            case 'string':
                return typeof value === 'string';
            case 'number':
                return typeof value === 'number';
            case 'boolean':
                return typeof value === 'boolean';
            case 'array':
                return Array.isArray(value);
            case 'object':
                return typeof value === 'object' && value !== null && !Array.isArray(value);
            default:
                return true; // æœªçŸ¥ç±»å‹ï¼Œé€šè¿‡éªŒè¯
        }
    }
}
/**
 * åŠ¨ä½œæ’ä»¶åŸºç±»
 */
export class Action extends Plugin {
}
/**
 * è½¬æ¢å™¨æ’ä»¶åŸºç±»
 */
export class Transform extends Plugin {
    async execute(inputs) {
        try {
            const inputData = inputs.data;
            const transformedData = await this.transform(inputData);
            return this.createSuccessResult({
                data: transformedData
            });
        }
        catch (error) {
            return this.createErrorResult(error instanceof Error ? error.message : 'è½¬æ¢å¤±è´¥', 'TRANSFORM_ERROR');
        }
    }
}
/**
 * è¿æ¥å™¨æ’ä»¶åŸºç±»
 */
export class Connector extends Plugin {
}
